# æ™ºæ…§ç“¦æ–¯ AI ç®¡ç†ç³»çµ±ï¼šæŠ€è¡“æ¶æ§‹è¨­è¨ˆ

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ç”¨æˆ¶ä»‹é¢ (Web/Mobile)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    API Gateway Layer                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   AI Prompt Router                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å®¢æˆ¶å¸³å‹™   â”‚ â”‚  æˆæœ¬åˆ†æ   â”‚ â”‚  æ´¾å·¥ç®¡ç†   â”‚ â”‚ ç¶­ä¿®ç®¡ç†â”‚ â”‚
â”‚  â”‚   AI æ¨¡çµ„   â”‚ â”‚   AI æ¨¡çµ„   â”‚ â”‚   AI æ¨¡çµ„   â”‚ â”‚ AI æ¨¡çµ„ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   è³‡æ–™åº«å±¤ (ERP + AI Cache)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                å¤–éƒ¨ API æ•´åˆ (æ”¿åºœã€ä¸­æ²¹ç­‰)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒçµ„ä»¶è¨­è¨ˆ

### 1. AI Prompt Router
```python
class PromptRouter:
    def __init__(self):
        self.modules = {
            'accounting': AccountingModule(),
            'cost_analysis': CostAnalysisModule(),
            'dispatch': DispatchModule(),
            'maintenance': MaintenanceModule(),
            'contract': ContractModule(),
            'faq': FAQModule()
        }
    
    def route_query(self, user_input: str):
        # è‡ªç„¶èªè¨€è™•ç†ï¼Œè­˜åˆ¥æ„åœ–
        intent = self.classify_intent(user_input)
        # è·¯ç”±åˆ°å°æ‡‰æ¨¡çµ„
        return self.modules[intent].process(user_input)
```

### 2. æ¨¡çµ„åŒ– AI è™•ç†å™¨
```python
class BaseAIModule:
    def __init__(self, system_prompt: str):
        self.system_prompt = system_prompt
        self.context = []
    
    def process(self, user_input: str):
        # æ§‹å»ºå®Œæ•´æç¤ºè©
        full_prompt = self.build_prompt(user_input)
        # èª¿ç”¨ AI API
        response = self.call_ai_api(full_prompt)
        # å¾Œè™•ç†å›æ‡‰
        return self.post_process(response)
    
    def build_prompt(self, user_input: str):
        return f"""
        {self.system_prompt}
        
        ç”¨æˆ¶æŸ¥è©¢: {user_input}
        
        è«‹æ ¹æ“šä»¥ä¸Šç³»çµ±è¨­å®šï¼Œæä¾›è©³ç´°çš„åˆ†æå’Œå»ºè­°ã€‚
        """
```

## ğŸ“Š è³‡æ–™åº«è¨­è¨ˆ

### æ ¸å¿ƒè³‡æ–™è¡¨çµæ§‹
```sql
-- å®¢æˆ¶è³‡æ–™
CREATE TABLE customers (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    phone VARCHAR(20),
    address TEXT,
    credit_limit DECIMAL(10,2),
    payment_terms VARCHAR(50),
    created_at TIMESTAMP
);

-- æ‡‰æ”¶å¸³æ¬¾
CREATE TABLE accounts_receivable (
    id INT PRIMARY KEY,
    customer_id INT,
    amount DECIMAL(10,2),
    due_date DATE,
    status VARCHAR(20),
    created_at TIMESTAMP
);

-- ç“¦æ–¯æ¡¶ç®¡ç†
CREATE TABLE gas_cylinders (
    id INT PRIMARY KEY,
    cylinder_number VARCHAR(50),
    capacity DECIMAL(5,2),
    status VARCHAR(20),
    location VARCHAR(100),
    last_maintenance DATE
);

-- æ´¾å·¥è¨˜éŒ„
CREATE TABLE dispatch_records (
    id INT PRIMARY KEY,
    employee_id INT,
    customer_id INT,
    task_type VARCHAR(50),
    scheduled_time TIMESTAMP,
    completed_time TIMESTAMP,
    status VARCHAR(20)
);

-- æˆæœ¬è¨˜éŒ„
CREATE TABLE cost_records (
    id INT PRIMARY KEY,
    cost_type VARCHAR(50),
    amount DECIMAL(10,2),
    date DATE,
    description TEXT
);
```

## ğŸ”Œ API ç«¯é»è¨­è¨ˆ

### RESTful API çµæ§‹
```python
# å®¢æˆ¶å¸³å‹™ API
@app.route('/api/customers/<int:customer_id>/balance', methods=['GET'])
def get_customer_balance(customer_id):
    return ai_router.route_query(f"æŸ¥è©¢å®¢æˆ¶ {customer_id} çš„æ¬ æ¬¾")

# æˆæœ¬åˆ†æ API
@app.route('/api/cost/analysis', methods=['POST'])
def analyze_costs():
    data = request.json
    return ai_router.route_query(f"åˆ†æ {data['period']} çš„æˆæœ¬è¶¨å‹¢")

# æ´¾å·¥ç®¡ç† API
@app.route('/api/dispatch/optimize', methods=['POST'])
def optimize_dispatch():
    data = request.json
    return ai_router.route_query(f"å„ªåŒ– {data['date']} çš„æ´¾å·¥è·¯ç·š")

# ç¶­ä¿®ç®¡ç† API
@app.route('/api/maintenance/schedule', methods=['POST'])
def schedule_maintenance():
    data = request.json
    return ai_router.route_query(f"å®‰æ’ {data['location']} çš„ç¶­ä¿®ä»»å‹™")
```

## ğŸ¤– AI æ¨¡å‹æ•´åˆ

### 1. æç¤ºè©æ¨¡æ¿ç³»çµ±
```python
class PromptTemplate:
    def __init__(self):
        self.templates = {
            'accounting': {
                'balance_check': "æŸ¥è©¢å®¢æˆ¶ {customer_name} çš„æ‡‰æ”¶å¸³æ¬¾ç‹€æ³",
                'credit_analysis': "åˆ†æå®¢æˆ¶ {customer_name} çš„ä¿¡ç”¨é¢¨éšª",
                'overdue_list': "åˆ—å‡ºè¶…é {days} å¤©æœªæ”¶æ¬¾çš„å®¢æˆ¶"
            },
            'cost_analysis': {
                'cost_calculation': "è¨ˆç®— {period} æœŸé–“çš„å¹³å‡æ¯æ¡¶æˆæœ¬",
                'profit_analysis': "åˆ†æ {period} æœŸé–“çš„åˆ©æ½¤è®ŠåŒ–åŸå› ",
                'trend_prediction': "é æ¸¬æœªä¾† {months} å€‹æœˆçš„æˆæœ¬è¶¨å‹¢"
            }
        }
    
    def get_prompt(self, module: str, action: str, **kwargs):
        template = self.templates[module][action]
        return template.format(**kwargs)
```

### 2. AI å›æ‡‰è™•ç†å™¨
```python
class AIResponseProcessor:
    def __init__(self):
        self.response_formats = {
            'data_query': self.format_data_response,
            'analysis': self.format_analysis_response,
            'recommendation': self.format_recommendation_response,
            'alert': self.format_alert_response
        }
    
    def process_response(self, ai_response: str, response_type: str):
        formatter = self.response_formats.get(response_type)
        return formatter(ai_response) if formatter else ai_response
    
    def format_data_response(self, response: str):
        # å°‡ AI å›æ‡‰è½‰æ›ç‚ºçµæ§‹åŒ–æ•¸æ“š
        return {
            'type': 'data',
            'content': response,
            'timestamp': datetime.now().isoformat()
        }
```

## ğŸ”„ å·¥ä½œæµç¨‹è¨­è¨ˆ

### 1. è‡ªç„¶èªè¨€æŸ¥è©¢æµç¨‹
```
ç”¨æˆ¶è¼¸å…¥ â†’ æ„åœ–è­˜åˆ¥ â†’ æ¨¡çµ„è·¯ç”± â†’ AI è™•ç† â†’ è³‡æ–™æŸ¥è©¢ â†’ å›æ‡‰ç”Ÿæˆ â†’ çµæœè¿”å›
```

### 2. è‡ªå‹•åŒ–è­¦å ±æµç¨‹
```
è³‡æ–™ç›£æ§ â†’ ç•°å¸¸æª¢æ¸¬ â†’ AI åˆ†æ â†’ è­¦å ±ç”Ÿæˆ â†’ é€šçŸ¥ç™¼é€ â†’ å»ºè­°æä¾›
```

### 3. å ±è¡¨ç”Ÿæˆæµç¨‹
```
å®šæœŸè§¸ç™¼ â†’ è³‡æ–™æ”¶é›† â†’ AI åˆ†æ â†’ å ±è¡¨ç”Ÿæˆ â†’ è‡ªå‹•ç™¼é€ â†’ å­˜æª”è¨˜éŒ„
```

## ğŸ›¡ï¸ å®‰å…¨æ€§è¨­è¨ˆ

### 1. è³‡æ–™å®‰å…¨
- æ‰€æœ‰æ•æ„Ÿè³‡æ–™åŠ å¯†å„²å­˜
- API å­˜å–éœ€è¦èº«ä»½é©—è­‰
- è³‡æ–™åº«é€£ç·šä½¿ç”¨ SSL/TLS

### 2. AI å®‰å…¨
- æç¤ºè©æ³¨å…¥é˜²è­·
- å›æ‡‰å…§å®¹éæ¿¾
- ä½¿ç”¨é‡é™åˆ¶èˆ‡ç›£æ§

### 3. ç³»çµ±å®‰å…¨
- å®šæœŸå®‰å…¨æ›´æ–°
- å­˜å–æ—¥èªŒè¨˜éŒ„
- å‚™ä»½èˆ‡ç½é›£æ¢å¾©

## ğŸ“ˆ æ•ˆèƒ½å„ªåŒ–

### 1. å¿«å–ç­–ç•¥
```python
class AICache:
    def __init__(self):
        self.cache = {}
        self.ttl = 3600  # 1å°æ™‚éæœŸ
    
    def get_cached_response(self, query_hash: str):
        if query_hash in self.cache:
            cached = self.cache[query_hash]
            if time.time() - cached['timestamp'] < self.ttl:
                return cached['response']
        return None
    
    def cache_response(self, query_hash: str, response: str):
        self.cache[query_hash] = {
            'response': response,
            'timestamp': time.time()
        }
```

### 2. éåŒæ­¥è™•ç†
```python
import asyncio

async def process_ai_query(user_input: str):
    # éåŒæ­¥è™•ç† AI æŸ¥è©¢
    response = await ai_router.async_route_query(user_input)
    return response

async def batch_process_queries(queries: List[str]):
    # æ‰¹é‡è™•ç†å¤šå€‹æŸ¥è©¢
    tasks = [process_ai_query(query) for query in queries]
    return await asyncio.gather(*tasks)
```

## ğŸš€ éƒ¨ç½²å»ºè­°

### 1. å®¹å™¨åŒ–éƒ¨ç½²
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 8000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 2. å¾®æœå‹™æ¶æ§‹
- æ¯å€‹ AI æ¨¡çµ„ç¨ç«‹éƒ¨ç½²
- ä½¿ç”¨æ¶ˆæ¯ä½‡åˆ—é€²è¡Œæ¨¡çµ„é–“é€šè¨Š
- è² è¼‰å‡è¡¡èˆ‡è‡ªå‹•æ“´å±•

### 3. ç›£æ§èˆ‡æ—¥èªŒ
- ä½¿ç”¨ Prometheus ç›£æ§ç³»çµ±æ•ˆèƒ½
- ELK Stack é€²è¡Œæ—¥èªŒåˆ†æ
- å³æ™‚è­¦å ±ç³»çµ±

---

*æ­¤æ¶æ§‹è¨­è¨ˆå¯æ ¹æ“šå¯¦éš›éœ€æ±‚é€²è¡Œèª¿æ•´å’Œæ“´å±•ã€‚* 